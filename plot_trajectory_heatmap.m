function [ax1,ax2,lim]=plot_trajectory_heatmap(dat,fields,ii,ii_num,name,color,xmax,ymax,num,col,row,trajectory,centered_plot,heatmap,ax1,ax2,lim)
% this function will just simply plot the trajectory and the heatmap
%for the trajectory
%num is for numbering the figure
%tell the function to plot the centered plot or not:'y' or []
%trajectory:'y' or []
%heatmap:'y' or []
%ii_num:number of the final loop, 5 in this case
%ax1,ax2,lim are the one that are generated by the plots
x_pos=find(matches(fields,'x'));
y_pos=find(matches(fields,'y'));
%% Plot trajectory
if ~isempty(trajectory)
    
    
    figure(num);
  
    if ii==1
        %this depends on how many groups you have
        tiledlayout(col,row);
    end
    
    hold on
    ax1(ii)=nexttile;
    scatter1=scatter(dat{x_pos,1},dat{y_pos,1},0.1,color(ii));
    scatter1.MarkerEdgeAlpha=0.05;
    title(name(ii));
    axis square
    if ii==ii_num %change it based on your looping
        linkaxes(ax1,'xy')
    end
    
    hold off
else 
    ax1=[];
end
%% Plot centered trajectories
if ~isempty(centered_plot)
    xc=find(matches(fields,'xcentered'));
    yc=find(matches(fields,'ycentered'));
    
    figure(num+1)
    if ii==1
        %this depends on how many groups you have
        tiledlayout(col,row);
    end
    hold on
    ax2(ii)=nexttile;
    scatter2=scatter(dat{xc,1},dat{yc,1},0.1,color(ii));
    scatter2.MarkerEdgeAlpha=0.05;
    title(name(ii));
    axis square
    if ii==ii_num %change it based on your looping
        linkaxes(ax2,'xy')
    end
    
    hold off
else 
    ax2=[];
    
end
%% Plot heatmap
%simply count all the data point in each x and y bins
if ~isempty(heatmap)
    x=0:5:round(xmax);
    y=0:5:round(ymax);
    
    for a=1:length(x)-1
        for b=1:length(y)-1
            idx=find(dat{x_pos,1}>x(a)&dat{x_pos,1}<=x(a+1)&dat{y_pos}>y(b)&dat{y_pos}<y(b+1));
            num_dat(length(y)-b,a)=length(idx);
            clear idx;
        end
    end
    
    figure(num+2)
    hold on
    subplot(row,col,ii)
    
    imagesc(num_dat);
    xticklabels([x(10),x(20),x(30),x(40)]);
    yticklabels([y(end)-y(10),y(end)-y(20),y(end)-y(30),y(end)-y(40)]);
    title(name(ii));
    colorbar
    
    %output is the variable lim which is the limit of the of the colorbar-->for
    %caliberatin later
    lim(ii,:)=caxis;
    hold off
else
    lim(ii,:)=nan;
end
end
